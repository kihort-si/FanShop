<Window x:Class="FanShop.Windows.TaskCategoriesWindow"
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
       xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
       xmlns:local="clr-namespace:FanShop.Windows"
       mc:Ignorable="d"
       Title="Категории задач" Height="600" Width="650"
       WindowStyle="None" ResizeMode="NoResize"
       WindowStartupLocation="CenterScreen" Icon="/icon.ico"
       ShowInTaskbar="False" AllowsTransparency="True"
       Background="Transparent" BorderThickness="0">

   <Border Background="Transparent" CornerRadius="8">
       <Grid>
           <Grid.RowDefinitions>
               <RowDefinition Height="Auto"/>
               <RowDefinition Height="*"/>
               <RowDefinition Height="Auto"/>
           </Grid.RowDefinitions>

           <Border x:Name="HeaderBorder" Grid.Row="0" CornerRadius="8,8,0,0" MouseLeftButtonDown="Border_MouseLeftButtonDown">
               <Border.Background>
                   <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                       <GradientStop Color="#009EE1" Offset="0.0"/>
                       <GradientStop Color="#0077B5" Offset="1.0"/>
                   </LinearGradientBrush>
               </Border.Background>
               <Grid Height="40">
                   <TextBlock Text="КАТЕГОРИИ ЗАДАЧ" FontSize="14" FontWeight="Bold" Foreground="White"
                              VerticalAlignment="Center" HorizontalAlignment="Center"/>
                   <Button Content="✕" HorizontalAlignment="Right" Width="40" Height="40"
                           Background="Transparent" Foreground="White" BorderThickness="0"
                           Command="{Binding CloseWindowCommand}" FontWeight="Bold" FontSize="14">
                       <Button.Style>
                           <Style TargetType="Button">
                               <Setter Property="Template">
                                   <Setter.Value>
                                       <ControlTemplate TargetType="Button">
                                           <Border Background="{TemplateBinding Background}" Padding="8">
                                               <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                           </Border>
                                       </ControlTemplate>
                                   </Setter.Value>
                               </Setter>
                               <Style.Triggers>
                                   <Trigger Property="IsMouseOver" Value="True">
                                       <Setter Property="Background" Value="#E81123"/>
                                   </Trigger>
                               </Style.Triggers>
                           </Style>
                       </Button.Style>
                   </Button>
               </Grid>
           </Border>

           <Border Grid.Row="1" CornerRadius="0, 0, 8, 8" BorderThickness="3, 0, 3, 3" Background="White">
               <Border.BorderBrush>
                   <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                       <GradientStop Color="#009EE1" Offset="0.0"/>
                       <GradientStop Color="#0077B5" Offset="1.0"/>
                   </LinearGradientBrush>
               </Border.BorderBrush>
               <Grid>
                   <Grid.RowDefinitions>
                       <RowDefinition Height="Auto"/>
                       <RowDefinition Height="*"/>
                       <RowDefinition Height="Auto"/>
                   </Grid.RowDefinitions>
                   <Border Grid.Row="0" Background="#F2F9FF" Padding="15">
                       <TextBlock Text="Список категорий" FontSize="16" FontWeight="SemiBold"
                                  Foreground="#333333" HorizontalAlignment="Center"/>
                   </Border>

                   <ListBox Grid.Row="1" ItemsSource="{Binding TaskCategories}"
                            SelectedItem="{Binding SelectedCategory}"
                            Margin="15" BorderThickness="1" BorderBrush="#E0E0E0">
                       <ListBox.ItemTemplate>
                           <DataTemplate>
                               <Border Background="#F8F9FA" BorderBrush="#E9ECEF"
                                       BorderThickness="1" CornerRadius="5"
                                       Padding="15,10" Margin="0,2">
                                   <Grid>
                                       <Grid.RowDefinitions>
                                           <RowDefinition Height="Auto"/>
                                           <RowDefinition Height="Auto"/>
                                       </Grid.RowDefinitions>
                                       <Grid.ColumnDefinitions>
                                           <ColumnDefinition Width="*"/>
                                           <ColumnDefinition Width="Auto"/>
                                       </Grid.ColumnDefinitions>

                                       <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                           <Rectangle Width="30" Height="30" Stroke="#666666" StrokeThickness="1" Margin="0,0,5,0">
                                               <Rectangle.Fill>
                                                   <SolidColorBrush Color="{Binding Color}"/>
                                               </Rectangle.Fill>
                                           </Rectangle>
                                           <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="15" VerticalAlignment="Center"/>
                                       </StackPanel>
                                   
                                       <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,6,0,0">
                                           <TextBlock Text="{Binding DefaultTask, StringFormat='Основная задача: {0}'}"
                                                      FontSize="12" Foreground="#666666"/>
                                       </StackPanel>

                                       <Border Grid.RowSpan="2" Grid.Column="1" Background="#E3F2FD"
                                               CornerRadius="4" Padding="8,4" VerticalAlignment="Center">
                                           <TextBlock Text="Категория" Foreground="#0077B5"
                                                      FontWeight="Medium" FontSize="12"/>
                                       </Border>
                                   </Grid>
                               </Border>
                           </DataTemplate>
                       </ListBox.ItemTemplate>
                       <ListBox.ItemContainerStyle>
                           <Style TargetType="ListBoxItem">
                               <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                               <Setter Property="Padding" Value="5"/>
                               <Setter Property="Margin" Value="0,2"/>
                               <Setter Property="Background" Value="Transparent"/>
                               <Style.Triggers>
                                   <Trigger Property="IsSelected" Value="True">
                                       <Setter Property="Background" Value="#E3F2FD"/>
                                       <Setter Property="BorderThickness" Value="0"/>
                                   </Trigger>
                                   <Trigger Property="IsMouseOver" Value="True">
                                       <Setter Property="Background" Value="#F0F7FF"/>
                                   </Trigger>
                               </Style.Triggers>
                           </Style>
                       </ListBox.ItemContainerStyle>
                   </ListBox>

                   <Border Grid.Row="2" Background="#F5F5F5" CornerRadius="0,0,8,8" Padding="10">
                       <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                           <Button Content="Добавить" Width="100" Height="36"
                                   Background="#009EE1" Foreground="White" Margin="6,0"
                                   BorderThickness="0" Cursor="Hand"
                                   Command="{Binding AddCategoryCommand}">
                               <Button.Template>
                                   <ControlTemplate TargetType="Button">
                                       <Border Background="{TemplateBinding Background}"
                                               CornerRadius="4" Padding="12,6">
                                           <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                       </Border>
                                   </ControlTemplate>
                               </Button.Template>
                               <Button.Style>
                                   <Style TargetType="Button">
                                       <Style.Triggers>
                                           <Trigger Property="IsMouseOver" Value="True">
                                               <Setter Property="Opacity" Value="0.9"/>
                                           </Trigger>
                                       </Style.Triggers>
                                   </Style>
                               </Button.Style>
                           </Button>

                           <Button Content="Изменить" Width="100" Height="36"
                                   Background="#4CAF50" Foreground="White" Margin="6,0"
                                   BorderThickness="0" Cursor="Hand"
                                   Command="{Binding EditCategoryCommand}"
                                   IsEnabled="{Binding CanEditCategory}">
                               <Button.Template>
                                   <ControlTemplate TargetType="Button">
                                       <Border Background="{TemplateBinding Background}"
                                               CornerRadius="4" Padding="12,6">
                                           <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                       </Border>
                                   </ControlTemplate>
                               </Button.Template>
                               <Button.Style>
                                   <Style TargetType="Button">
                                       <Style.Triggers>
                                           <Trigger Property="IsMouseOver" Value="True">
                                               <Setter Property="Opacity" Value="0.9"/>
                                           </Trigger>
                                           <Trigger Property="IsEnabled" Value="False">
                                               <Setter Property="Opacity" Value="0.5"/>
                                           </Trigger>
                                       </Style.Triggers>
                                   </Style>
                               </Button.Style>
                           </Button>

                           <Button Content="Удалить" Width="100" Height="36"
                                   Background="#EB0004" Foreground="White" Margin="6,0"
                                   BorderThickness="0" Cursor="Hand"
                                   Command="{Binding RemoveCategoryCommand}"
                                   IsEnabled="{Binding CanEditCategory}">
                               <Button.Template>
                                   <ControlTemplate TargetType="Button">
                                       <Border Background="{TemplateBinding Background}"
                                               CornerRadius="4" Padding="12,6">
                                           <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                       </Border>
                                   </ControlTemplate>
                               </Button.Template>
                               <Button.Style>
                                   <Style TargetType="Button">
                                       <Style.Triggers>
                                           <Trigger Property="IsMouseOver" Value="True">
                                               <Setter Property="Opacity" Value="0.9"/>
                                           </Trigger>
                                           <Trigger Property="IsEnabled" Value="False">
                                               <Setter Property="Opacity" Value="0.5"/>
                                           </Trigger>
                                       </Style.Triggers>
                                   </Style>
                               </Button.Style>
                           </Button>

                           <Button Content="Закрыть" Width="100" Height="36"
                                   Background="#666666" Foreground="White" Margin="6,0"
                                   BorderThickness="0" Cursor="Hand"
                                   Command="{Binding CloseWindowCommand}">
                               <Button.Template>
                                   <ControlTemplate TargetType="Button">
                                       <Border Background="{TemplateBinding Background}"
                                               CornerRadius="4" Padding="12,6">
                                           <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                       </Border>
                                   </ControlTemplate>
                               </Button.Template>
                               <Button.Style>
                                   <Style TargetType="Button">
                                       <Style.Triggers>
                                           <Trigger Property="IsMouseOver" Value="True">
                                               <Setter Property="Opacity" Value="0.9"/>
                                           </Trigger>
                                       </Style.Triggers>
                                   </Style>
                               </Button.Style>
                           </Button>
                       </StackPanel>
                   </Border>
               </Grid>
           </Border>

           <Border Grid.RowSpan="4" Background="#80000000"
                   Visibility="{Binding IsEditOverlayVisible, Converter={x:Static local:BooleanToVisibilityConverter.Instance}}" CornerRadius="8">
               <Border Background="Transparent" CornerRadius="8" MaxWidth="500" MaxHeight="550">
                   <Grid>
                       <Grid.RowDefinitions>
                           <RowDefinition Height="Auto"/>
                           <RowDefinition Height="Auto"/>
                           <RowDefinition Height="*"/>
                           <RowDefinition Height="Auto"/>
                       </Grid.RowDefinitions>

                       <Border Grid.Row="0" CornerRadius="8,8,0,0">
                           <Border.Background>
                               <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                   <GradientStop Color="#009EE1" Offset="0.0"/>
                                   <GradientStop Color="#0077B5" Offset="1.0"/>
                               </LinearGradientBrush>
                           </Border.Background>
                           <Grid Height="40">
                               <TextBlock Text="ДАННЫЕ КАТЕГОРИИ" FontSize="14" FontWeight="Bold" Foreground="White"
                                          VerticalAlignment="Center" HorizontalAlignment="Center"/>
                           </Grid>
                       </Border>

                       <Border Grid.Row="1" CornerRadius="0, 0, 8, 8" BorderThickness="3, 0, 3, 3" Background="White">
                           <Border.BorderBrush>
                               <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                   <GradientStop Color="#009EE1" Offset="0.0"/>
                                   <GradientStop Color="#0077B5" Offset="1.0"/>
                               </LinearGradientBrush>
                           </Border.BorderBrush>
                           <Grid>
                               <Grid.RowDefinitions>
                                   <RowDefinition Height="Auto"/>
                                   <RowDefinition Height="*"/>
                                   <RowDefinition Height="Auto"/>
                               </Grid.RowDefinitions>
                               <Border Grid.Row="0" Background="#F2F9FF" Padding="15">
                                   <TextBlock Text="{Binding SelectedCategory, Converter={x:Static local:CategoryTitleConverter.Instance}}"
                                                         FontSize="16" FontWeight="SemiBold"
                                                         Foreground="#333333" HorizontalAlignment="Center"/>
                               </Border>

                               <StackPanel Grid.Row="1" Margin="20,10">
                                   <TextBlock Text="Название категории*:" FontWeight="Medium" Foreground="#333333" Margin="0,0,0,5"/>
                                   <Border Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="1"
                                           CornerRadius="4" Padding="10,8" Margin="0,0,0,15">
                                       <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"
                                                BorderThickness="0" Background="Transparent" FontSize="14"/>
                                   </Border>

                                   <TextBlock Text="Описание:" FontWeight="Medium" Foreground="#333333" Margin="0,0,0,5"/>
                                   <Border Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="1"
                                           CornerRadius="4" Padding="10,8" Margin="0,0,0,15">
                                       <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}"
                                                BorderThickness="0" Background="Transparent" FontSize="14"
                                                TextWrapping="Wrap" AcceptsReturn="True" Height="70"/>
                                   </Border>
                                   
                                   <TextBlock Text="Задача по умолчанию:" FontWeight="Medium" Foreground="#333333" Margin="0,0,0,5"/>
                                   <Border Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="1"
                                           CornerRadius="4" Padding="10,8" Margin="0,0,0,15">
                                       <TextBox Text="{Binding DefaultTask, UpdateSourceTrigger=PropertyChanged}"
                                                BorderThickness="0" Background="Transparent" FontSize="14"/>
                                   </Border>
                                   
                                   <StackPanel Margin="0,0,0,10">
                                       <TextBlock Text="Цвет*:" FontWeight="Medium" Foreground="#333333" Margin="0,0,0,5"/>
                                       <StackPanel Orientation="Horizontal">
                                           <Button Width="30" Height="30" Margin="0,0,10,0" 
                                                   Command="{Binding OpenColorPickerCommand}"
                                                   Background="Transparent" BorderThickness="0" Padding="0">
                                               <Rectangle Width="30" Height="30" Stroke="Black" StrokeThickness="1">
                                                   <Rectangle.Fill>
                                                       <SolidColorBrush Color="{Binding Color}"/>
                                                   </Rectangle.Fill>
                                               </Rectangle>
                                           </Button>
                                           <TextBox Text="{Binding Color, UpdateSourceTrigger=PropertyChanged}" 
                                                    Width="100" Height="30" Padding="5" BorderBrush="#009EE1" VerticalAlignment="Top"/>
                                           <Button Content="🎨" Width="30" Height="30" Margin="5,0,0,0"
                                                   Command="{Binding GenerateRandomColorCommand}" 
                                                   Background="#009EE1" Foreground="White" BorderThickness="0" Cursor="Hand"/>
                                       </StackPanel>
                                   </StackPanel>
                                   
                                   <TextBlock Text="* - обязательные поля" 
                                              FontSize="10" Foreground="Gray" Margin="0,0,0,10"/>
                               </StackPanel>

                               <Border Grid.Row="2" Background="#F5F5F5" CornerRadius="0,0,8,8" Padding="0, 18, 0, 18">
                                   <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                       <Button Content="Сохранить" Width="120" Height="36"
                                               Background="#009EE1" Foreground="White"
                                               BorderThickness="0" Margin="0,0,15,0" Cursor="Hand"
                                               Command="{Binding SaveEditedCategoryCommand}"
                                               IsEnabled="{Binding CanSaveCategory}">
                                           <Button.Template>
                                               <ControlTemplate TargetType="Button">
                                                   <Border Background="{TemplateBinding Background}"
                                                           CornerRadius="4" Padding="12,6">
                                                       <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                   </Border>
                                               </ControlTemplate>
                                           </Button.Template>
                                           <Button.Style>
                                               <Style TargetType="Button">
                                                   <Style.Triggers>
                                                       <Trigger Property="IsEnabled" Value="False">
                                                           <Setter Property="Opacity" Value="0.5"/>
                                                       </Trigger>
                                                       <Trigger Property="IsMouseOver" Value="True">
                                                           <Setter Property="Opacity" Value="0.9"/>
                                                       </Trigger>
                                                   </Style.Triggers>
                                               </Style>
                                           </Button.Style>
                                       </Button>

                                       <Button Content="Отмена" Width="120" Height="36"
                                               Background="#666666" Foreground="White"
                                               BorderThickness="0" Margin="0" Cursor="Hand"
                                               Command="{Binding CancelEditCommand}">
                                           <Button.Template>
                                               <ControlTemplate TargetType="Button">
                                                   <Border Background="{TemplateBinding Background}"
                                                           CornerRadius="4" Padding="12,6">
                                                       <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                   </Border>
                                               </ControlTemplate>
                                           </Button.Template>
                                           <Button.Style>
                                               <Style TargetType="Button">
                                                   <Style.Triggers>
                                                       <Trigger Property="IsMouseOver" Value="True">
                                                           <Setter Property="Opacity" Value="0.9"/>
                                                       </Trigger>
                                                   </Style.Triggers>
                                               </Style>
                                           </Button.Style>
                                       </Button>
                                   </StackPanel>
                               </Border>
                           </Grid>
                       </Border>
                   </Grid>
               </Border>
           </Border>
       </Grid>
   </Border>
</Window>